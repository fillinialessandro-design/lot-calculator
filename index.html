<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Lot Calculator PRO – Dual Account (MT4)</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:#0b1220;
  color:#e5e7eb;
}
.wrap{max-width:820px;margin:auto;padding:18px}

/* HEADER */
.header{
  text-align:center;
  margin-bottom:22px;
}
.header h1{
  margin:0;
  font-size:28px;
  letter-spacing:0.3px;
}
.header .subtitle{
  margin-top:8px;
  font-size:13px;
  letter-spacing:0.4px;
  color:#9ca3af;
}
.header .copyright{
  margin-top:6px;
  font-size:12px;
  color:#6b7280;
}

/* CARDS */
.card{
  background:#111b2e;
  border-radius:18px;
  padding:16px;
  margin-bottom:16px;
}
h2{margin:0 0 10px;font-size:16px}
label{font-size:12px;color:#94a3b8}
input,select{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid #1f2a44;
  background:#0f172a;
  color:#fff;
  font-size:16px;
}
.row{display:grid;gap:12px}
@media(min-width:640px){.two{grid-template-columns:1fr 1fr}}

button{
  width:100%;
  padding:15px;
  border-radius:16px;
  border:0;
  background:#2563eb;
  color:#fff;
  font-weight:800;
  font-size:16px;
  cursor:pointer;
}

.result{
  margin-top:10px;
  padding:12px;
  border-radius:14px;
  background:#052e16;
  border:1px solid #22c55e;
}
.result input{
  background:#022c22;
  border-color:#22c55e;
  font-size:20px;
  font-weight:900;
  text-align:center;
}

.warning{
  margin-top:8px;
  padding:10px;
  border-radius:12px;
  background:#3b0a0a;
  border:1px solid #ef4444;
  color:#fecaca;
  font-size:13px;
  display:none;
  line-height:1.35;
}

.small{
  font-size:12px;
  color:#94a3b8;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="wrap">

  <!-- MAIN HEADER -->
  <div class="header">
    <h1>Lot Calculator PRO – Dual Account (MT4)</h1>
    <div class="subtitle">
      Precision trading tools – Produced by Alessandro Fillini
    </div>
    <div class="copyright">
      © 2026 Alessandro Fillini. All rights reserved.
    </div>
  </div>

  <!-- SHARED TRADE -->
  <div class="card">
    <h2>Trade (shared)</h2>

    <div class="row two">
      <div>
        <label>Symbol</label>
        <select id="pair">
          <option>XAUUSD</option>
          <option>USDJPY</option>
          <option>GBPJPY</option>
        </select>
      </div>
      <div>
        <label>Risk %</label>
        <input id="risk" value="1">
      </div>
    </div>

    <div class="row two">
      <div>
        <label>Entry</label>
        <input id="entry" inputmode="decimal" placeholder="e.g. 4748.137">
      </div>
      <div>
        <label>Stop</label>
        <input id="stop" inputmode="decimal" placeholder="e.g. 4664.836">
      </div>
    </div>

    <div class="small" id="distanceInfo">—</div>
  </div>

  <!-- ACCOUNT A -->
  <div class="card">
    <h2>Account A</h2>

    <div class="row two">
      <div>
        <label>Balance A</label>
        <input id="balA" value="100000" inputmode="decimal">
      </div>
      <div>
        <label>Currency</label>
        <select id="ccyA">
          <option>USD</option>
          <option>EUR</option>
        </select>
      </div>
    </div>

    <div class="result">
      <label>Lots</label>
      <input id="lotA" readonly value="—">
    </div>

    <div class="warning" id="warnA"></div>
  </div>

  <!-- ACCOUNT B -->
  <div class="card">
    <h2>Account B</h2>

    <div class="row two">
      <div>
        <label>Balance B</label>
        <input id="balB" value="6000" inputmode="decimal">
      </div>
      <div>
        <label>Currency</label>
        <select id="ccyB">
          <option>USD</option>
          <option>EUR</option>
        </select>
      </div>
    </div>

    <div class="result">
      <label>Lots</label>
      <input id="lotB" readonly value="—">
    </div>

    <div class="warning" id="warnB"></div>
  </div>

  <button onclick="calculate()">Calculate</button>

</div>

<script>
function n(v){ return Number(String(v).trim().replace(",", ".")); }

// Broker constraints (confirmed by your MT4: min lot 0.01)
const MIN_LOT  = 0.01;
const LOT_STEP = 0.01;

// XAUUSD (MT4 typical, as per your Symbol Specs screenshot)
// Tick size 0.01, tick value $1.00 per 1.00 lot
const TICK_SIZE  = 0.01;
const TICK_VALUE = 1.00;

// Math: raw lot from balance*risk% and entry-stop distance
function calcRawLot(balance, riskPct, entry, stop){
  const dist = Math.abs(entry - stop);
  const ticks = dist / TICK_SIZE;
  const riskMoney = balance * (riskPct / 100);
  return riskMoney / (ticks * TICK_VALUE);
}

// Conservative formatting (round down to step; if below minimum -> 0.00)
function formatLot(raw){
  if (raw < MIN_LOT) return 0;
  return Math.floor(raw / LOT_STEP) * LOT_STEP;
}

// If user chooses to trade MIN_LOT anyway, estimate the actual risk
function riskIfForcedLot(balance, entry, stop, forcedLot){
  const dist = Math.abs(entry - stop);
  const ticks = dist / TICK_SIZE;
  const riskUsd = ticks * TICK_VALUE * forcedLot; // in USD for XAUUSD tick value spec
  const riskPct = (riskUsd / balance) * 100;
  return { riskUsd, riskPct };
}

function setWarning(el, show, text){
  el.style.display = show ? "block" : "none";
  el.textContent = show ? text : "";
}

function calculate(){
  const entry = n(document.getElementById("entry").value);
  const stop  = n(document.getElementById("stop").value);
  const risk  = n(document.getElementById("risk").value);

  if(!isFinite(entry) || !isFinite(stop) || !isFinite(risk) || entry <= 0 || stop <= 0 || risk <= 0 || entry === stop){
    return;
  }

  const dist = Math.abs(entry - stop);
  document.getElementById("distanceInfo").textContent =
    `Entry–Stop distance: ${dist.toFixed(3)} (price)`;

  // ---- Account A
  const balAVal = n(balA.value);
  const rawA = calcRawLot(balAVal, risk, entry, stop);
  const lotA = formatLot(rawA);
  lotAEl.value = lotA.toFixed(2);

  if (rawA < MIN_LOT) {
    const forced = riskIfForcedLot(balAVal, entry, stop, MIN_LOT);
    setWarning(
      warnA,
      true,
      `⚠️ Below broker minimum (${MIN_LOT.toFixed(2)}). Calculated: ${rawA.toFixed(3)}\n` +
      `If you trade ${MIN_LOT.toFixed(2)} lots, estimated risk: ${forced.riskUsd.toFixed(2)} USD (${forced.riskPct.toFixed(2)}%)`
    );
  } else {
    setWarning(warnA, false, "");
  }

  // ---- Account B
  const balBVal = n(balB.value);
  const rawB = calcRawLot(balBVal, risk, entry, stop);
  const lotB = formatLot(rawB);
  lotBEl.value = lotB.toFixed(2);

  if (rawB < MIN_LOT) {
    const forced = riskIfForcedLot(balBVal, entry, stop, MIN_LOT);
    setWarning(
      warnB,
      true,
      `⚠️ Below broker minimum (${MIN_LOT.toFixed(2)}). Calculated: ${rawB.toFixed(3)}\n` +
      `If you trade ${MIN_LOT.toFixed(2)} lots, estimated risk: ${forced.riskUsd.toFixed(2)} USD (${forced.riskPct.toFixed(2)}%)`
    );
  } else {
    setWarning(warnB, false, "");
  }
}

const balA  = document.getElementById("balA");
const balB  = document.getElementById("balB");
const lotAEl = document.getElementById("lotA");
const lotBEl = document.getElementById("lotB");
const warnA  = document.getElementById("warnA");
const warnB  = document.getElementById("warnB");
</script>

</body>
</html>
